<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: OptionLab::Support
  
    &mdash; OptionLab Documentation
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "OptionLab::Support";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../OptionLab.html" title="OptionLab (module)">OptionLab</a></span></span>
     &raquo; 
    <span class="title">Support</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: OptionLab::Support
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/option_lab/support.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_array_price_from_BS-class_method" title="_get_array_price_from_BS (class method)">.<strong>_get_array_price_from_BS</strong>(inputs, n)  &#x21d2; Numo::DFloat </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Generate array of prices using Black-Scholes model.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_array_price_from_laplace-class_method" title="_get_array_price_from_laplace (class method)">.<strong>_get_array_price_from_laplace</strong>(inputs, n)  &#x21d2; Numo::DFloat </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Generate array of prices using Laplace distribution.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_payoff-class_method" title="_get_payoff (class method)">.<strong>_get_payoff</strong>(option_type, s, x)  &#x21d2; Numo::DFloat </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Calculate option payoff at expiration.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_pl_option-class_method" title="_get_pl_option (class method)">.<strong>_get_pl_option</strong>(option_type, opvalue, action, s, x)  &#x21d2; Numo::DFloat </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Calculate P/L of an option at expiration.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_pl_stock-class_method" title="_get_pl_stock (class method)">.<strong>_get_pl_stock</strong>(s0, action, s)  &#x21d2; Numo::DFloat </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Calculate P/L of a stock position.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_pop_array-class_method" title="_get_pop_array (class method)">.<strong>_get_pop_array</strong>(inputs, target)  &#x21d2; Array&lt;Float, Float, Float, Float&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Calculate PoP using array of terminal prices.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_pop_bs-class_method" title="_get_pop_bs (class method)">.<strong>_get_pop_bs</strong>(s, profit, inputs, profit_range)  &#x21d2; Array&lt;Float, Float, Float, Float&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Calculate PoP using Black-Scholes model.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_profit_range-class_method" title="_get_profit_range (class method)">.<strong>_get_profit_range</strong>(s, profit, target = 0.01)  &#x21d2; Array&lt;Array&lt;Array&lt;Float&gt;&gt;&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Find profit/loss ranges.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#_get_sign_changes-class_method" title="_get_sign_changes (class method)">.<strong>_get_sign_changes</strong>(profit, target)  &#x21d2; Array&lt;Integer&gt; </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Find indices where profit crosses target.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_price_array-class_method" title="create_price_array (class method)">.<strong>create_price_array</strong>(inputs_data, n: 100_000, seed: nil)  &#x21d2; Numo::DFloat </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create price array for simulations.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_price_seq-class_method" title="create_price_seq (class method)">.<strong>create_price_seq</strong>(min_price, max_price)  &#x21d2; Numo::DFloat </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Generate a sequence of stock prices from min to max with $0.01 increment.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pl_profile-class_method" title="get_pl_profile (class method)">.<strong>get_pl_profile</strong>(option_type, action, x, val, n, s, commission = 0.0)  &#x21d2; Array&lt;Numo::DFloat, Float&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get profit/loss profile and cost of an options trade at expiration.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pl_profile_bs-class_method" title="get_pl_profile_bs (class method)">.<strong>get_pl_profile_bs</strong>(option_type, action, x, val, r, target_to_maturity_years, volatility, n, s, y = 0.0, commission = 0.0)  &#x21d2; Array&lt;Numo::DFloat, Float&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get profit/loss profile and cost of an options trade before expiration using Black-Scholes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pl_profile_stock-class_method" title="get_pl_profile_stock (class method)">.<strong>get_pl_profile_stock</strong>(s0, action, n, s, commission = 0.0)  &#x21d2; Array&lt;Numo::DFloat, Float&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get profit/loss profile and cost of a stock position.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_pop-class_method" title="get_pop (class method)">.<strong>get_pop</strong>(s, profit, inputs_data, target = 0.01)  &#x21d2; Models::PoPOutputs </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Estimate probability of profit.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="_get_array_price_from_BS-class_method">
  
    .<strong>_get_array_price_from_BS</strong>(inputs, n)  &#x21d2; <tt>Numo::DFloat</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Generate array of prices using Black-Scholes model</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>inputs</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Models/BlackScholesModelInputs.html" title="OptionLab::Models::BlackScholesModelInputs (class)">Models::BlackScholesModelInputs</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Black-Scholes inputs</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>n</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Number of prices to generate</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of prices</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


437
438
439
440
441
442
443
444
445
446
447
448
449</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 437</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_array_price_from_BS'>_get_array_price_from_BS</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
  <span class='comment'># Calculate mean and std
</span>  <span class='id identifier rubyid_mean'>mean</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_stock_price'>stock_price</span><span class='rparen'>)</span> <span class='op'>+</span> 
         <span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_interest_rate'>interest_rate</span> <span class='op'>-</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_dividend_yield'>dividend_yield</span> <span class='op'>-</span> <span class='float'>0.5</span> <span class='op'>*</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_volatility'>volatility</span><span class='op'>**</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>*</span> 
         <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_years_to_target_date'>years_to_target_date</span>
  <span class='id identifier rubyid_std'>std</span> <span class='op'>=</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_volatility'>volatility</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_years_to_target_date'>years_to_target_date</span><span class='rparen'>)</span>
  
  <span class='comment'># Generate random values
</span>  <span class='id identifier rubyid_random_values'>random_values</span> <span class='op'>=</span> <span class='const'>Numo</span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rand_norm'>rand_norm</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
  
  <span class='comment'># Apply formula
</span>  <span class='const'>Numo</span><span class='op'>::</span><span class='const'>NMath</span><span class='period'>.</span><span class='id identifier rubyid_exp'>exp</span><span class='lparen'>(</span><span class='id identifier rubyid_mean'>mean</span> <span class='op'>+</span> <span class='id identifier rubyid_std'>std</span> <span class='op'>*</span> <span class='id identifier rubyid_random_values'>random_values</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_array_price_from_laplace-class_method">
  
    .<strong>_get_array_price_from_laplace</strong>(inputs, n)  &#x21d2; <tt>Numo::DFloat</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Generate array of prices using Laplace distribution</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>inputs</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Models/LaplaceInputs.html" title="OptionLab::Models::LaplaceInputs (class)">Models::LaplaceInputs</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Laplace inputs</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>n</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Number of prices to generate</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of prices</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


455
456
457
458
459
460
461
462
463
464
465
466
467
468</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 455</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_array_price_from_laplace'>_get_array_price_from_laplace</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
  <span class='comment'># Calculate location and scale
</span>  <span class='id identifier rubyid_location'>location</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_stock_price'>stock_price</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_mu'>mu</span> <span class='op'>*</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_years_to_target_date'>years_to_target_date</span>
  <span class='id identifier rubyid_scale'>scale</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_volatility'>volatility</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_years_to_target_date'>years_to_target_date</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='float'>2.0</span><span class='rparen'>)</span>
  
  <span class='comment'># Generate random values from uniform distribution
</span>  <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='const'>Numo</span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rand'>rand</span> <span class='op'>-</span> <span class='float'>0.5</span>
  
  <span class='comment'># Convert to Laplace distribution
</span>  <span class='id identifier rubyid_laplace_values'>laplace_values</span> <span class='op'>=</span> <span class='id identifier rubyid_location'>location</span> <span class='op'>-</span> <span class='id identifier rubyid_scale'>scale</span> <span class='op'>*</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&lt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='op'>-</span><span class='int'>1</span> <span class='op'>:</span> <span class='int'>1</span> <span class='rbrace'>}</span> <span class='op'>*</span> <span class='const'>Numo</span><span class='op'>::</span><span class='const'>NMath</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='int'>1</span> <span class='op'>-</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_u'>u</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rparen'>)</span>
  
  <span class='comment'># Apply formula
</span>  <span class='const'>Numo</span><span class='op'>::</span><span class='const'>NMath</span><span class='period'>.</span><span class='id identifier rubyid_exp'>exp</span><span class='lparen'>(</span><span class='id identifier rubyid_laplace_values'>laplace_values</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_payoff-class_method">
  
    .<strong>_get_payoff</strong>(option_type, s, x)  &#x21d2; <tt>Numo::DFloat</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Calculate option payoff at expiration</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>option_type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;call&#39; or &#39;put&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>x</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Strike price</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Option payoff</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229
230
231
232
233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 225</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_payoff'>_get_payoff</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_option_type'>option_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>call</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>-</span> <span class='id identifier rubyid_x'>x</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_diff'>diff</span> <span class='op'>+</span> <span class='id identifier rubyid_diff'>diff</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>2.0</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_option_type'>option_type</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>put</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_diff'>diff</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span> <span class='op'>-</span> <span class='id identifier rubyid_s'>s</span>
    <span class='lparen'>(</span><span class='id identifier rubyid_diff'>diff</span> <span class='op'>+</span> <span class='id identifier rubyid_diff'>diff</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='float'>2.0</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Option type must be either &#39;call&#39; or &#39;put&#39;!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_pl_option-class_method">
  
    .<strong>_get_pl_option</strong>(option_type, opvalue, action, s, x)  &#x21d2; <tt>Numo::DFloat</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Calculate P/L of an option at expiration</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>option_type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;call&#39; or &#39;put&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opvalue</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Option price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>action</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;buy&#39; or &#39;sell&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>x</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Strike price</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>P/L profile</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_pl_option'>_get_pl_option</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_opvalue'>opvalue</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sell</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_opvalue'>opvalue</span> <span class='op'>-</span> <span class='id identifier rubyid__get_payoff'>_get_payoff</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>buy</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid__get_payoff'>_get_payoff</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_opvalue'>opvalue</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Action must be either &#39;sell&#39; or &#39;buy&#39;!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_pl_stock-class_method">
  
    .<strong>_get_pl_stock</strong>(s0, action, s)  &#x21d2; <tt>Numo::DFloat</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Calculate P/L of a stock position</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>s0</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Spot price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>action</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;buy&#39; or &#39;sell&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>P/L profile</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244
245
246
247
248
249
250</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_pl_stock'>_get_pl_stock</span><span class='lparen'>(</span><span class='id identifier rubyid_s0'>s0</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sell</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_s0'>s0</span> <span class='op'>-</span> <span class='id identifier rubyid_s'>s</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>buy</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_s'>s</span> <span class='op'>-</span> <span class='id identifier rubyid_s0'>s0</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Action must be either &#39;sell&#39; or &#39;buy&#39;!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_pop_array-class_method">
  
    .<strong>_get_pop_array</strong>(inputs, target)  &#x21d2; <tt>Array&lt;Float, Float, Float, Float&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Calculate PoP using array of terminal prices</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>inputs</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Models/ArrayInputs.html" title="OptionLab::Models::ArrayInputs (class)">Models::ArrayInputs</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array inputs</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Return target</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Float, Float, Float, Float&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>PoP calculation results</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 312</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_pop_array'>_get_pop_array</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_array'>array</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The array is empty!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='comment'># Split array by target
</span>  <span class='id identifier rubyid_above_target'>above_target</span> <span class='op'>=</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_array'>array</span><span class='lbracket'>[</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_array'>array</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_target'>target</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_below_target'>below_target</span> <span class='op'>=</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_array'>array</span><span class='lbracket'>[</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_array'>array</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_target'>target</span><span class='rbracket'>]</span>
  
  <span class='comment'># Calculate probabilities
</span>  <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span> <span class='op'>=</span> <span class='id identifier rubyid_above_target'>above_target</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>/</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_array'>array</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span> <span class='op'>=</span> <span class='float'>1.0</span> <span class='op'>-</span> <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span>
  
  <span class='comment'># Calculate expected returns
</span>  <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span> <span class='op'>=</span> <span class='id identifier rubyid_above_target'>above_target</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id identifier rubyid_above_target'>above_target</span><span class='period'>.</span><span class='id identifier rubyid_mean'>mean</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span> <span class='op'>=</span> <span class='id identifier rubyid_below_target'>below_target</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id identifier rubyid_below_target'>below_target</span><span class='period'>.</span><span class='id identifier rubyid_mean'>mean</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='kw'>nil</span>
  
  <span class='lbracket'>[</span>
    <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span>
  <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_pop_bs-class_method">
  
    .<strong>_get_pop_bs</strong>(s, profit, inputs, profit_range)  &#x21d2; <tt>Array&lt;Float, Float, Float, Float&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Calculate PoP using Black-Scholes model</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>profit</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of profits</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>inputs</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Models/BlackScholesModelInputs.html" title="OptionLab::Models::BlackScholesModelInputs (class)">Models::BlackScholesModelInputs</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Model inputs</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>profit_range</span>
      
      
        <span class='type'>(<tt>Array&lt;Array&lt;Array&lt;Float&gt;&gt;&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Profit and loss ranges</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Float, Float, Float, Float&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>PoP calculation results</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 258</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_pop_bs'>_get_pop_bs</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_profit'>profit</span><span class='comma'>,</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='comma'>,</span> <span class='id identifier rubyid_profit_range'>profit_range</span><span class='rparen'>)</span>
  <span class='comment'># Initialize variables
</span>  <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span> <span class='op'>=</span> <span class='float'>0.0</span>
  <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span> <span class='op'>=</span> <span class='float'>0.0</span>
  
  <span class='comment'># Calculate sigma
</span>  <span class='id identifier rubyid_sigma'>sigma</span> <span class='op'>=</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_volatility'>volatility</span> <span class='op'>&gt;</span> <span class='float'>0.0</span> <span class='op'>?</span> 
    <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_volatility'>volatility</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_years_to_target_date'>years_to_target_date</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='float'>1e-10</span>
  
  <span class='comment'># Calculate PoP for each range
</span>  <span class='id identifier rubyid_profit_range'>profit_range</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_prob'>prob</span> <span class='op'>=</span> <span class='float'>0.0</span>
    
    <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span> <span class='op'>!=</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_p_range'>p_range</span><span class='op'>|</span>
        <span class='comment'># Calculate log values
</span>        <span class='id identifier rubyid_lval'>lval</span> <span class='op'>=</span> <span class='id identifier rubyid_p_range'>p_range</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='float'>0.0</span> <span class='op'>?</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='id identifier rubyid_p_range'>p_range</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='op'>-</span><span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span>
        <span class='id identifier rubyid_hval'>hval</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='id identifier rubyid_p_range'>p_range</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        
        <span class='comment'># Calculate drift and mean
</span>        <span class='id identifier rubyid_drift'>drift</span> <span class='op'>=</span> <span class='lparen'>(</span>
          <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_interest_rate'>interest_rate</span> <span class='op'>-</span> 
          <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_dividend_yield'>dividend_yield</span> <span class='op'>-</span> 
          <span class='float'>0.5</span> <span class='op'>*</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_volatility'>volatility</span> <span class='op'>*</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_volatility'>volatility</span>
        <span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_years_to_target_date'>years_to_target_date</span>
        
        <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_log'>log</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_stock_price'>stock_price</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_drift'>drift</span>
        
        <span class='comment'># Calculate probability
</span>        <span class='id identifier rubyid_prob'>prob</span> <span class='op'>+=</span> <span class='const'>Distribution</span><span class='op'>::</span><span class='const'>Normal</span><span class='period'>.</span><span class='id identifier rubyid_cdf'>cdf</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_hval'>hval</span> <span class='op'>-</span> <span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_sigma'>sigma</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='const'>Distribution</span><span class='op'>::</span><span class='const'>Normal</span><span class='period'>.</span><span class='id identifier rubyid_cdf'>cdf</span><span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_lval'>lval</span> <span class='op'>-</span> <span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='id identifier rubyid_sigma'>sigma</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span> <span class='op'>=</span> <span class='id identifier rubyid_prob'>prob</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span> <span class='op'>=</span> <span class='id identifier rubyid_prob'>prob</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  
  <span class='lbracket'>[</span>
    <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span>
  <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_profit_range-class_method">
  
    .<strong>_get_profit_range</strong>(s, profit, target = 0.01)  &#x21d2; <tt>Array&lt;Array&lt;Array&lt;Float&gt;&gt;&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Find profit/loss ranges</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>profit</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of profits</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0.01</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Profit target</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Array&lt;Array&lt;Float&gt;&gt;&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Profit and loss ranges</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_profit_range'>_get_profit_range</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_profit'>profit</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='float'>0.01</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_profit_range'>profit_range</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_loss_range'>loss_range</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  
  <span class='comment'># Find where profit crosses target
</span>  <span class='id identifier rubyid_crossings'>crossings</span> <span class='op'>=</span> <span class='id identifier rubyid__get_sign_changes'>_get_sign_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_profit'>profit</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n_crossings'>n_crossings</span> <span class='op'>=</span> <span class='id identifier rubyid_crossings'>crossings</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
  
  <span class='comment'># Handle case with no crossings
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_n_crossings'>n_crossings</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_profit'>profit</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_target'>target</span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Find profit and loss ranges
</span>  <span class='id identifier rubyid_lb_profit'>lb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_hb_profit'>hb_profit</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_lb_loss'>lb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_hb_loss'>hb_loss</span> <span class='op'>=</span> <span class='kw'>nil</span>
  
  <span class='id identifier rubyid_crossings'>crossings</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_profit'>profit</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_profit'>profit</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_lb_profit'>lb_profit</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_hb_profit'>hb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_lb_loss'>lb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
        
        <span class='id identifier rubyid_hb_loss'>hb_loss</span> <span class='op'>=</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span> <span class='kw'>if</span> <span class='id identifier rubyid_n_crossings'>n_crossings</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_lb_profit'>lb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_lb_loss'>lb_loss</span> <span class='op'>=</span> <span class='float'>0.0</span>
        <span class='id identifier rubyid_hb_loss'>hb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
        
        <span class='id identifier rubyid_hb_profit'>hb_profit</span> <span class='op'>=</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span> <span class='kw'>if</span> <span class='id identifier rubyid_n_crossings'>n_crossings</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='kw'>end</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>==</span> <span class='id identifier rubyid_n_crossings'>n_crossings</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_profit'>profit</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_profit'>profit</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_lb_profit'>lb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_hb_profit'>hb_profit</span> <span class='op'>=</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span>
        <span class='id identifier rubyid_hb_loss'>hb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_hb_profit'>hb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_lb_loss'>lb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_hb_loss'>hb_loss</span> <span class='op'>=</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_profit'>profit</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_profit'>profit</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_lb_profit'>lb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_hb_loss'>hb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_hb_profit'>hb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_lb_loss'>lb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    
    <span class='kw'>if</span> <span class='id identifier rubyid_lb_profit'>lb_profit</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_hb_profit'>hb_profit</span>
      <span class='id identifier rubyid_profit_range'>profit_range</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_lb_profit'>lb_profit</span><span class='comma'>,</span> <span class='id identifier rubyid_hb_profit'>hb_profit</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_lb_profit'>lb_profit</span> <span class='op'>=</span> <span class='id identifier rubyid_hb_profit'>hb_profit</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
    
    <span class='kw'>if</span> <span class='id identifier rubyid_lb_loss'>lb_loss</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_hb_loss'>hb_loss</span>
      <span class='id identifier rubyid_loss_range'>loss_range</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_lb_loss'>lb_loss</span><span class='comma'>,</span> <span class='id identifier rubyid_hb_loss'>hb_loss</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_lb_loss'>lb_loss</span> <span class='op'>=</span> <span class='id identifier rubyid_hb_loss'>hb_loss</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  
  <span class='lbracket'>[</span><span class='id identifier rubyid_profit_range'>profit_range</span><span class='comma'>,</span> <span class='id identifier rubyid_loss_range'>loss_range</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="_get_sign_changes-class_method">
  
    .<strong>_get_sign_changes</strong>(profit, target)  &#x21d2; <tt>Array&lt;Integer&gt;</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Find indices where profit crosses target</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>profit</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of profits</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Profit target</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Integer&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of indices</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 416</span>

<span class='kw'>def</span> <span class='id identifier rubyid__get_sign_changes'>_get_sign_changes</span><span class='lparen'>(</span><span class='id identifier rubyid_profit'>profit</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
  <span class='comment'># Subtract target and add small epsilon
</span>  <span class='id identifier rubyid_p_temp'>p_temp</span> <span class='op'>=</span> <span class='id identifier rubyid_profit'>profit</span> <span class='op'>-</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>+</span> <span class='float'>1e-10</span>
  
  <span class='comment'># Get signs (convert to array first since Numo::DFloat doesn&#39;t have collect)
</span>  <span class='id identifier rubyid_signs_1'>signs_1</span> <span class='op'>=</span> <span class='id identifier rubyid_p_temp'>p_temp</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>...</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='op'>-</span><span class='int'>1</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_signs_2'>signs_2</span> <span class='op'>=</span> <span class='id identifier rubyid_p_temp'>p_temp</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='op'>-</span><span class='int'>1</span> <span class='rbrace'>}</span>
  
  <span class='comment'># Find sign changes
</span>  <span class='id identifier rubyid_changes'>changes</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_signs_1'>signs_1</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_s1'>s1</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_changes'>changes</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span> <span class='kw'>if</span> <span class='id identifier rubyid_s1'>s1</span> <span class='op'>*</span> <span class='id identifier rubyid_signs_2'>signs_2</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>&lt;</span> <span class='int'>0</span>
  <span class='kw'>end</span>
  
  <span class='id identifier rubyid_changes'>changes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_price_array-class_method">
  
    .<strong>create_price_array</strong>(inputs_data, n: 100_000, seed: nil)  &#x21d2; <tt>Numo::DFloat</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create price array for simulations</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>inputs_data</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt><span class='object_link'><a href="Models/BlackScholesModelInputs.html" title="OptionLab::Models::BlackScholesModelInputs (class)">Models::BlackScholesModelInputs</a></span></tt>, <tt><span class='object_link'><a href="Models/LaplaceInputs.html" title="OptionLab::Models::LaplaceInputs (class)">Models::LaplaceInputs</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Model inputs</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>n</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>100_000</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Number of prices to generate</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>seed</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Random seed</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of prices</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 169</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_price_array'>create_price_array</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='comma'>,</span> <span class='label'>n:</span> <span class='int'>100_000</span><span class='comma'>,</span> <span class='label'>seed:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='comment'># Set random seed if provided
</span>  <span class='const'>Kernel</span><span class='period'>.</span><span class='id identifier rubyid_srand'>srand</span><span class='lparen'>(</span><span class='id identifier rubyid_seed'>seed</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_seed'>seed</span>
  
  <span class='comment'># Convert hash to appropriate model if needed
</span>  <span class='id identifier rubyid_inputs'>inputs</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
            <span class='kw'>if</span> <span class='qwords_beg'>%w[</span><span class='tstring_content'>black-scholes</span><span class='words_sep'> </span><span class='tstring_content'>normal</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='lbracket'>[</span><span class='symbol'>:model</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>model</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
              <span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models/BlackScholesModelInputs.html" title="OptionLab::Models::BlackScholesModelInputs (class)">BlackScholesModelInputs</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Models/BlackScholesModelInputs.html#initialize-instance_method" title="OptionLab::Models::BlackScholesModelInputs#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='rparen'>)</span>
            <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='lbracket'>[</span><span class='symbol'>:model</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>model</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>laplace</span><span class='tstring_end'>&#39;</span></span>
              <span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models/LaplaceInputs.html" title="OptionLab::Models::LaplaceInputs (class)">LaplaceInputs</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Models/LaplaceInputs.html#initialize-instance_method" title="OptionLab::Models::LaplaceInputs#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='rparen'>)</span>
            <span class='kw'>else</span>
              <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid model type!</span><span class='tstring_end'>&quot;</span></span>
            <span class='kw'>end</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_inputs_data'>inputs_data</span>
          <span class='kw'>end</span>
  
  <span class='comment'># Generate array based on model
</span>  <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models/BlackScholesModelInputs.html" title="OptionLab::Models::BlackScholesModelInputs (class)">BlackScholesModelInputs</a></span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid__get_array_price_from_BS'>_get_array_price_from_BS</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_inputs'>inputs</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models/LaplaceInputs.html" title="OptionLab::Models::LaplaceInputs (class)">LaplaceInputs</a></span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid__get_array_price_from_laplace'>_get_array_price_from_laplace</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs'>inputs</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid inputs type!</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>end</span>
  
  <span class='comment'># Reset random seed
</span>  <span class='const'>Kernel</span><span class='period'>.</span><span class='id identifier rubyid_srand'>srand</span> <span class='kw'>if</span> <span class='id identifier rubyid_seed'>seed</span>
  
  <span class='id identifier rubyid_arr'>arr</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_price_seq-class_method">
  
    .<strong>create_price_seq</strong>(min_price, max_price)  &#x21d2; <tt>Numo::DFloat</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Generate a sequence of stock prices from min to max with $0.01 increment</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>min_price</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Minimum stock price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>max_price</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Maximum stock price</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of sequential stock prices</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 100</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_price_seq'>create_price_seq</span><span class='lparen'>(</span><span class='id identifier rubyid_min_price'>min_price</span><span class='comma'>,</span> <span class='id identifier rubyid_max_price'>max_price</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cache_key'>cache_key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_min_price'>min_price</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_price'>max_price</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  
  <span class='comment'># Return cached result if available
</span>  <span class='kw'>return</span> <span class='ivar'>@price_seq_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_cache_key'>cache_key</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='ivar'>@price_seq_cache</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_cache_key'>cache_key</span><span class='rparen'>)</span>
  
  <span class='kw'>if</span> <span class='id identifier rubyid_max_price'>max_price</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_min_price'>min_price</span>
    <span class='comment'># Create array with increment 0.01
</span>    <span class='id identifier rubyid_steps'>steps</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_max_price'>max_price</span> <span class='op'>-</span> <span class='id identifier rubyid_min_price'>min_price</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='int'>100</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='const'>Numo</span><span class='op'>::</span><span class='const'>DFloat</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_steps'>steps</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_seq'>seq</span><span class='lparen'>(</span><span class='id identifier rubyid_min_price'>min_price</span><span class='comma'>,</span> <span class='float'>0.01</span><span class='rparen'>)</span>
    
    <span class='comment'># Round to 2 decimal places (Numo::DFloat doesn&#39;t support arguments to round)
</span>    <span class='id identifier rubyid_arr'>arr</span> <span class='op'>=</span> <span class='id identifier rubyid_arr'>arr</span><span class='period'>.</span><span class='id identifier rubyid_round'>round</span>
    
    <span class='comment'># Cache the result
</span>    <span class='ivar'>@price_seq_cache</span><span class='lbracket'>[</span><span class='id identifier rubyid_cache_key'>cache_key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_arr'>arr</span>
    
    <span class='id identifier rubyid_arr'>arr</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Maximum price cannot be less than minimum price!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_pl_profile-class_method">
  
    .<strong>get_pl_profile</strong>(option_type, action, x, val, n, s, commission = 0.0)  &#x21d2; <tt>Array&lt;Numo::DFloat, Float&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get profit/loss profile and cost of an options trade at expiration</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>option_type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;call&#39; or &#39;put&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>action</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;buy&#39; or &#39;sell&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>x</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Strike price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>val</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Option price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>n</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Number of options</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>commission</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0.0</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Brokerage commission</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Numo::DFloat, Float&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>P/L profile and cost</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 21</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_pl_profile'>get_pl_profile</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_commission'>commission</span> <span class='op'>=</span> <span class='float'>0.0</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>buy</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_cost'>cost</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_val'>val</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sell</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_cost'>cost</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Action must be either &#39;buy&#39; or &#39;sell&#39;!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models.html#OPTION_TYPES-constant" title="OptionLab::Models::OPTION_TYPES (constant)">OPTION_TYPES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='rparen'>)</span>
    <span class='lbracket'>[</span>
      <span class='id identifier rubyid_n'>n</span> <span class='op'>*</span> <span class='id identifier rubyid__get_pl_option'>_get_pl_option</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_commission'>commission</span><span class='comma'>,</span>
      <span class='id identifier rubyid_n'>n</span> <span class='op'>*</span> <span class='id identifier rubyid_cost'>cost</span> <span class='op'>-</span> <span class='id identifier rubyid_commission'>commission</span>
    <span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Option type must be either &#39;call&#39; or &#39;put&#39;!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_pl_profile_bs-class_method">
  
    .<strong>get_pl_profile_bs</strong>(option_type, action, x, val, r, target_to_maturity_years, volatility, n, s, y = 0.0, commission = 0.0)  &#x21d2; <tt>Array&lt;Numo::DFloat, Float&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get profit/loss profile and cost of an options trade before expiration using Black-Scholes</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>option_type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;call&#39; or &#39;put&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>action</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;buy&#39; or &#39;sell&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>x</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Strike price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>val</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Option price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>r</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Risk-free interest rate</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target_to_maturity_years</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Time remaining to maturity from target date</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>volatility</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Volatility</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>n</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Number of options</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>y</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0.0</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Dividend yield</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>commission</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0.0</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Brokerage commission</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Numo::DFloat, Float&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>P/L profile and cost</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 75</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_pl_profile_bs'>get_pl_profile_bs</span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_target_to_maturity_years'>target_to_maturity_years</span><span class='comma'>,</span> <span class='id identifier rubyid_volatility'>volatility</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='float'>0.0</span><span class='comma'>,</span> <span class='id identifier rubyid_commission'>commission</span> <span class='op'>=</span> <span class='float'>0.0</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>buy</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_cost'>cost</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_val'>val</span>
    <span class='id identifier rubyid_factor'>factor</span> <span class='op'>=</span> <span class='int'>1</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sell</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_cost'>cost</span> <span class='op'>=</span> <span class='id identifier rubyid_val'>val</span>
    <span class='id identifier rubyid_factor'>factor</span> <span class='op'>=</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Action must be either &#39;buy&#39; or &#39;sell&#39;!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='comment'># Calculate prices using Black-Scholes
</span>  <span class='id identifier rubyid_d1'>d1</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BlackScholes.html" title="OptionLab::BlackScholes (module)">BlackScholes</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_d1'><span class='object_link'><a href="BlackScholes.html#get_d1-class_method" title="OptionLab::BlackScholes.get_d1 (method)">get_d1</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_volatility'>volatility</span><span class='comma'>,</span> <span class='id identifier rubyid_target_to_maturity_years'>target_to_maturity_years</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_d2'>d2</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BlackScholes.html" title="OptionLab::BlackScholes (module)">BlackScholes</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_d2'><span class='object_link'><a href="BlackScholes.html#get_d2-class_method" title="OptionLab::BlackScholes.get_d2 (method)">get_d2</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_volatility'>volatility</span><span class='comma'>,</span> <span class='id identifier rubyid_target_to_maturity_years'>target_to_maturity_years</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_calc_price'>calc_price</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="BlackScholes.html" title="OptionLab::BlackScholes (module)">BlackScholes</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get_option_price'><span class='object_link'><a href="BlackScholes.html#get_option_price-class_method" title="OptionLab::BlackScholes.get_option_price (method)">get_option_price</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_option_type'>option_type</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_x'>x</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='comma'>,</span> <span class='id identifier rubyid_target_to_maturity_years'>target_to_maturity_years</span><span class='comma'>,</span> <span class='id identifier rubyid_d1'>d1</span><span class='comma'>,</span> <span class='id identifier rubyid_d2'>d2</span><span class='comma'>,</span> <span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_profile'>profile</span> <span class='op'>=</span> <span class='id identifier rubyid_factor'>factor</span> <span class='op'>*</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_calc_price'>calc_price</span> <span class='op'>-</span> <span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_commission'>commission</span>
  
  <span class='lbracket'>[</span><span class='id identifier rubyid_profile'>profile</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span> <span class='op'>*</span> <span class='id identifier rubyid_cost'>cost</span> <span class='op'>-</span> <span class='id identifier rubyid_commission'>commission</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_pl_profile_stock-class_method">
  
    .<strong>get_pl_profile_stock</strong>(s0, action, n, s, commission = 0.0)  &#x21d2; <tt>Array&lt;Numo::DFloat, Float&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get profit/loss profile and cost of a stock position</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>s0</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Initial stock price</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>action</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>&#39;buy&#39; or &#39;sell&#39;</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>n</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Number of shares</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>commission</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0.0</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Brokerage commission</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Numo::DFloat, Float&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>P/L profile and cost</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_pl_profile_stock'>get_pl_profile_stock</span><span class='lparen'>(</span><span class='id identifier rubyid_s0'>s0</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_commission'>commission</span> <span class='op'>=</span> <span class='float'>0.0</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>buy</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_cost'>cost</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_s0'>s0</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_action'>action</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sell</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_cost'>cost</span> <span class='op'>=</span> <span class='id identifier rubyid_s0'>s0</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Action must be either &#39;buy&#39; or &#39;sell&#39;!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  
  <span class='lbracket'>[</span>
    <span class='id identifier rubyid_n'>n</span> <span class='op'>*</span> <span class='id identifier rubyid__get_pl_stock'>_get_pl_stock</span><span class='lparen'>(</span><span class='id identifier rubyid_s0'>s0</span><span class='comma'>,</span> <span class='id identifier rubyid_action'>action</span><span class='comma'>,</span> <span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id identifier rubyid_commission'>commission</span><span class='comma'>,</span>
    <span class='id identifier rubyid_n'>n</span> <span class='op'>*</span> <span class='id identifier rubyid_cost'>cost</span> <span class='op'>-</span> <span class='id identifier rubyid_commission'>commission</span>
  <span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_pop-class_method">
  
    .<strong>get_pop</strong>(s, profit, inputs_data, target = 0.01)  &#x21d2; <tt><span class='object_link'><a href="Models/PoPOutputs.html" title="OptionLab::Models::PoPOutputs (class)">Models::PoPOutputs</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Estimate probability of profit</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>s</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of stock prices</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>profit</span>
      
      
        <span class='type'>(<tt>Numo::DFloat</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of profits</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>inputs_data</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Models/BlackScholesModelInputs.html" title="OptionLab::Models::BlackScholesModelInputs (class)">Models::BlackScholesModelInputs</a></span></tt>, <tt><span class='object_link'><a href="Models/ArrayInputs.html" title="OptionLab::Models::ArrayInputs (class)">Models::ArrayInputs</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Model inputs</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>target</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>0.01</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Return target</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Models/PoPOutputs.html" title="OptionLab::Models::PoPOutputs (class)">Models::PoPOutputs</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Probability of profit outputs</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/option_lab/support.rb', line 129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_pop'>get_pop</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_profit'>profit</span><span class='comma'>,</span> <span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span> <span class='op'>=</span> <span class='float'>0.01</span><span class='rparen'>)</span>
  <span class='comment'># Initialize variables
</span>  <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span> <span class='op'>=</span> <span class='float'>0.0</span>
  <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span> <span class='op'>=</span> <span class='float'>0.0</span>
  <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span> <span class='op'>=</span> <span class='kw'>nil</span>
  
  <span class='comment'># Get profit ranges
</span>  <span class='id identifier rubyid_t_ranges'>t_ranges</span> <span class='op'>=</span> <span class='id identifier rubyid__get_profit_range'>_get_profit_range</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_profit'>profit</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_reaching_target_range'>reaching_target_range</span> <span class='op'>=</span> <span class='id identifier rubyid_t_ranges'>t_ranges</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='id identifier rubyid_t_ranges'>t_ranges</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_missing_target_range'>missing_target_range</span> <span class='op'>=</span> <span class='id identifier rubyid_t_ranges'>t_ranges</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='float'>0.0</span><span class='comma'>,</span> <span class='float'>0.0</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='id identifier rubyid_t_ranges'>t_ranges</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  
  <span class='comment'># Calculate PoP based on inputs model
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models/BlackScholesModelInputs.html" title="OptionLab::Models::BlackScholesModelInputs (class)">BlackScholesModelInputs</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span><span class='comma'>,</span> <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span><span class='comma'>,</span> <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span> <span class='op'>=</span> 
      <span class='id identifier rubyid__get_pop_bs'>_get_pop_bs</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='comma'>,</span> <span class='id identifier rubyid_profit'>profit</span><span class='comma'>,</span> <span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='comma'>,</span> <span class='id identifier rubyid_t_ranges'>t_ranges</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models/ArrayInputs.html" title="OptionLab::Models::ArrayInputs (class)">ArrayInputs</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span><span class='comma'>,</span> <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span><span class='comma'>,</span>
    <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span><span class='comma'>,</span> <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span> <span class='op'>=</span> 
      <span class='id identifier rubyid__get_pop_array'>_get_pop_array</span><span class='lparen'>(</span><span class='id identifier rubyid_inputs_data'>inputs_data</span><span class='comma'>,</span> <span class='id identifier rubyid_target'>target</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Return outputs
</span>  <span class='const'><span class='object_link'><a href="Models.html" title="OptionLab::Models (module)">Models</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Models/PoPOutputs.html" title="OptionLab::Models::PoPOutputs (class)">PoPOutputs</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Models/PoPOutputs.html#initialize-instance_method" title="OptionLab::Models::PoPOutputs#initialize (method)">new</a></span></span><span class='lparen'>(</span>
    <span class='label'>probability_of_reaching_target:</span> <span class='id identifier rubyid_probability_of_reaching_target'>probability_of_reaching_target</span><span class='comma'>,</span>
    <span class='label'>probability_of_missing_target:</span> <span class='id identifier rubyid_probability_of_missing_target'>probability_of_missing_target</span><span class='comma'>,</span>
    <span class='label'>reaching_target_range:</span> <span class='id identifier rubyid_reaching_target_range'>reaching_target_range</span><span class='comma'>,</span>
    <span class='label'>missing_target_range:</span> <span class='id identifier rubyid_missing_target_range'>missing_target_range</span><span class='comma'>,</span>
    <span class='label'>expected_return_above_target:</span> <span class='id identifier rubyid_expected_return_above_target'>expected_return_above_target</span><span class='comma'>,</span>
    <span class='label'>expected_return_below_target:</span> <span class='id identifier rubyid_expected_return_below_target'>expected_return_below_target</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Apr 27 02:08:10 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.3.3).
</div>

    </div>
  </body>
</html>